## 首页

老师们好，我是网络空间安全的学生袁瑞，我的指导老师是彭林宁老师。我的论文主题是一种TDD/FDD模式下低时延宽带无线信道密钥生成系统研究。

## 目录

我将从以下背景、本文主要工作、无线密钥生成的主要步骤、系统性能评估几个方面介绍工作

## 背景

下面介绍背景

## 背景

传统安全机制在无线通信网络安全方面发挥比较重要的作用。但是这种机制也拥有明显的局限性

* 不适用于低功耗的网络节点设备
* 或被量子计算攻破
* 密钥分发依赖第三方可信机构

无线信道密钥协商从物理层的角度去解决安全性问题，计算复杂度小，且不依赖第三方机构

在无线通信物理层安全研究中，通信双方的信道具有很好的短时互易性，可以从无线信道中提取出相似的信道特征并生成一致的密钥。该技术可以利用无线信道天然的随机性为无线通信系统实时的分配密钥。

## 本文主要工作

下面介绍本文主要工作

## 本文主要工作

* 基于无线密钥生成技术理论，设计完整无线密钥生成技术方案，搭建TDD/FDD无线密钥生成系统
* 基于TDD/FDD无线密钥生成系统，研究不同场景下无线密钥生成系统的安全性和可靠性
* 使用系统多次实验，分析通信参与者CSI的相关性、无线信道随机性、密钥的随机程度、信息泄漏量、密钥生成速率、系统纠错性能

## 无线密钥生成技术的主要步骤

下面介绍无线密钥生成技术的主要步骤

## 无线密钥生成技术的主要步骤

本文设计的无线信道密钥生成系统同主要分为

* 信道测量
* 信道估计
* 量化编码
* 信息调和

整体结构如右图所示

## 无线密钥生成技术的主要步骤-信道测量-信道模型

在TDD通信系统中，考虑一对合法用户Alice和Bob在多径衰落信道工作，通信双方互相发送已知导频信号，在相干时间内，经过相同的信道衰落到达对方，接收方由接收到的导频信号和已知导频信号估计这段时间内的信道

对于第三方eve来说，即使窃听了导频信号，但是由于导频信号经过了不同的信道衰落，因此eve无法估计出合法信道之间的信道特征

## 无线密钥生成技术的主要步骤-信道测量-导频信号设计

Alice和Bob互相发送导频序列估计信道，本文基于m序列优秀的循环自相关特性，使用m序列进行无线信道估计，使用不同频率的正弦波区分TDD的上下行。导频信号由正弦信号、m序列、OFDM数据以及正弦信号组成。

首尾两端正弦波是为了在接收端通过fft或者其他手段检测出这段导频信号，检测出这段导频信号之后，进一步通过m序列的自相关特性精确定位m序列的起始位置，并截取m序列作为实际接收到的训练序列，根据实际接收的训练序列与已知m序列结合公式估计信道

## 无线密钥生成技术的主要步骤-信道测量-导频信号收发机

为了实现信道测量，基于usrp和GNURadio开发导频信号收发机，usrp负责数据采集，射频前端将数据转换到基带信号，并送入通用pc中处理数据，gnuadio封装了pc和usrp交互的协议，并提供一些读取数据和写入数据的底层接口

导频信号收发机由四个模块组成：导频数据输出模块，usrp数据发射模块、usrp数据接收模块、导频信号检测模块

* 导频数据输出模块 该模块读取或者生成需要发射的导频信号，其输入有一控制信号，该信号用于是否发射导频信号
* usrp数据发射模块 该模块将基带信号变为调制信号，输入到usrp外设，然后发射
* usrp数据接收模块 通用计算机从网口或者usb读入数据流，该模块将调制信号变为基带信号
* 导频信号检测模块 该模块不断输入基带数据，通过fft检测某段信号是否为正弦波，如果检测到某段信号首尾两端均是正弦波，且长度符合导频信号，则将其存储，供其估计信道使用

右边这个图是检波的过程，这个过程出现在GNURadio检波程序中，相对于传统的相关检波，其时间复杂度更低。在检测过程中，会对每128点长度的新号段作fft，并判断是否是指定频率的正弦波，当指定长度的信号段前后均出现这样的正弦波，表明检测到指定导频信号，将这段信号dump到硬盘。

## 无线密钥生成技术的主要步骤-信道测量-细同步

粗同步只是为了在高速数据流中有效的截取导频信号，检波模块将检测到的导频信号转存到硬盘中，转存到硬盘的导频信号首尾两端是不完整的正弦波，首尾两端正弦波之和是一个固定值，但是首尾和尾部分别多长不知道，为了进一步确定导频信号在数据流中的边界，需要进行细同步

本文使用m序列作为细同步和信道估计所用序列，因为细同步发生在导频信号转存之后，对实时性要求不高，因此本文利用m序列的自相关特性来精确定位导频信号的起始点

从粗同步中保存的数据流起点开始遍历，用已知m序列和相同长度数据点做互相关，找到互相关值最大的偏移位置，就是导频信号在数据流中的精确位置

## 无线密钥生成技术的主要步骤-信道测量-细同步

这张图是系统转存的实际导频信号，其中包含第一段检波所用正弦波，以及m序列

## 无线密钥生成技术的主要步骤-信道测量-细同步

这张图是已知m序列原始信号

## 无线密钥生成技术的主要步骤-信道测量-细同步

这张图是转存信号中与已知m序列做相关结果，其中根据波峰位置可以精确定位导频信号中的m序列的起始位置

## 无线密钥生成技术的主要步骤-信道测量-导频信号收发机

导频数据输出模块和usrp数据发射模块构成发射机，usrp数据接收模块和导频信号检测模块构成接收机

上层程序通过控制Alice的导频序列发射模块，发射导频信号，讲导频信号调制到制定频点，并通过usrp射频前端发射导频信号

Bob使用导频信号检测模块不断检测导频信号，当检测到导频信号时，转存到磁盘，并触发导频信号发射事件，通知发射机中的导频序列发射模块发射导频信号

Bob端的发射机发射导频信号之后，Alice接收机中的导频信号检测模块可以检测到Bob端发射的导频信号，并转存导频信号到磁盘。一次信道探测过程完成。

实际上，检测算法由于阈值设定过高或者过低，有可能检测不到对方发射的导频信号或者将错误信号数据误认为导频信号，因此Alice设计重发机制，在一次信道探测过程中，Alice会每隔一定时间，重新发射一次导频信号，直到检测Bob回发的导频信号



## 无线密钥生成技术的主要步骤-信道估计

从导频信号中截取m序列 m~(k)，和已知原始信号m(k)循环位移、然后相乘相加，得到信道估计的结果

再通过fft得到频域响应，然后移除直流分量，再做一次平滑，得到最终结果CSI

如果是平滑前后的CSI对照图，红色是平滑前，绿色是平滑后

## 无线密钥生成技术的主要步骤-量化编码

本文会对生成的CSI进行降采样，一方面可以提高密钥一致率，另一方面可以降低密钥泄漏率

降采样之后，再进行归一化处理，本文现将CSI归一化到[0, 2^L)的范围内，并四舍五入到整数，其中L为整数，再除以2^(L-R)然后向下取整得到最终量化值，量化阶数就是R

量化之后，进行格雷编码，减少比特的不一致率，最后再进行8b10b编码使得01比特分部更加均匀、随机

本文用这种方式进行量化，其中L = 7, R = 3。也就是先把数据范围伸缩到[0, 128)，再量化到[0, 8)这个范围内，然后对照格雷码转成01比特，生成一段比特流

## 无线密钥生成技术的主要步骤-信息调和

在量化编码之后，通信双发需要进一步调和来消除密钥中不一致比特

* 一种是基于CRC校验的信息调和方法
* 另外一种基于纠错码的信息调和方法

基于CRC校验的方法，是对比特流分组，对每组生成CRC校验码，通信双发比较每一组校验码，校验码不一致的组直接舍弃，校验码相同的组保留

基于纠错码的信息调和方法，该方法将需要传递的会话密钥进行纠错编码，之后和特征量化步骤中生成的比特流依次异或加密，再通过公共信道发送给对方。对方收到后同样先和比特流依次进行异或解密，再进行纠错解码，得到会话密钥。

在特征量化步骤中，通信双方生成的比特流并不一致，该方法实际上将不一致的比特位当做信道过程中的干扰项，并基于纠错码的特点对不一致的比特进行纠错

但是当错误比特数超过纠错码性能时，接收方就无法正确恢复纠错码

为了接收方可以判断纠错的正确性，发送方可以在调和时附带会话密钥的摘要，依次判断是否纠正成功，如果纠错失败，则需要重新开始一次密钥协商过程

## 无线密钥生成技术的主要步骤-信息调和

本文使用CRC-12 校验，其生成多项式为x12 + x11 + x3 + x2 + x + 1，对应二进制为 1100000001111 

这张图展示了某次测量过程中，Alice 和Bob 量化之后的比特流按7 分组的结果、Alice 分组计算得到的CRC 冗余码、Bob 根据Alice发送过来的
冗余码得到的校验结果（1 表示匹配，0 表示不匹配）。

## 无线密钥生成系统的性能评估

下面介绍无线密钥生成系统的性能评估

## 无线密钥生成系统的性能评估

下面会讨论如何定量分析系统的可靠性和安全性，主要考虑以下指标

* 合法通信双方和窃听者CSI的互易性
* CSI信息泄漏率
* CSI随机性
* 密钥随机性
* 密钥生成速率
* BCH、Turbo的BER

实际测量中的信道环境更加复杂，因此本文在室内房间、室内走廊、室外三个场景下的终端固定、终端移动和人员移动三种不同信道环境下测量数据，然后计算上述指标。所以其实一共有9种情况

## 无线密钥生成系统的性能评估-TDD

本文在TDD 模式下的9种情况中，连续长时间采取600组数据，用于实验结果分析

TDD模式下的试验参数如表所示，通信方在2535MHz的频点发射和接收导频信号，导频信号前后两端设有正弦波，Alice发射的导频信号的正弦波频率为4Hz，Bob发射的导频信号的正弦波频率为8Hz，两者使用相同的、长度为 4095 的 M 序列用于精同步和信道估计，USRP 的采样率均设置为 25 MHz

三个场景下、三种信道环境的600组CSI如图5.5所示，图中只展示了 Alice 的结果。图中 x 轴是测量次数，y 轴是子载波数，z 轴是幅度值，即从时间的维度来观察 CSI 的变化。

## 系统性能评估-TDD-CSI相关性

本文对每一组数据（一组数据包含alice的csi、bob的csi、eve的csi），计算alice和bob之间csi的互相关系数、alice和eve之间csi的互相关系数

在9种情况下，计算600组数据，得到左图，其中蓝色表示Alice和Bob之间CSI相关系数，红色表示alice和eve之间的相关系数

alice和bob之间相关系数稳定在1附近，alice和eve之间相关系数波动较大且较小

将多组数据取平均得到右图，右图中alice和bob之间的相关系数均高于0.9711，最高为0.9963，出现在室内房间终端固定的情况。alice和eve之间的相关系数最高为0.8192，出现在室内房间终端固定的情况，其他情况，无论是室内、走廊还是室外，alice和eve信道相关性都很低

## 系统性能评估-TDD-安全信息率

无线密钥生成的所有过程对第三方来说都是透明的，第三方可以在信道探测过程中窃听中间信息，因此本文通过信息论中未泄露的信息量来评估系统的安全性

设Alice、Bob和Eve对信道探测为Ha、Hb和He，则A和B之间信道互信息为Ik

存在eve时，alice和bob之间的互信息量为Isk

通过Isk和Ik的比例来评估信息安全比率

本文在9种情况下按照公式计算多组安全信息率并取平均，9种情况下的平均安全信息率如图所示

右图中，无论是室内、走廊还是室外，均是当有人员在周围环境走动时安全信息率最高，其中在室外，信息安全比率高达91.01，在走廊，信息安全比率为78.52%。在所有情况中，室内房间终端移动时的信息安全比率最低，为67.05%

## 系统性能评估-TDD-随机性评估

本文使用两种指标来作系统的随机性评估

CSI的随机性既有时域的变化，也有频域的变化，为了衡量CSI的随机性，本文采集不同场景下的多组CSI，使用CSI的二维FFT的图像熵来衡量信道的随机性

先对多组CSI作二维fft得到F，为了缩小值之间的差距，取指数对数得到L，再归一化到[0, 1]得到I

然后将[0, 1]区间均分成256份，统计I在各个区间的概率，计算I的熵

密钥的随机性使用NIST随机性测试来评估

## 系统性能评估-TDD-随机性评估-CSI随机性

为了更好的对比，本文计算了信道无多径且不随时间变化、信道有多径且不随时间变化、信道随时间不同完全随机变换三种特殊情况下的CSI作为对比，其CSI如图，熵值如表所示。信道完全无多径且不变化时，图像熵接近0，信道有多径且不随时间变化时稍大，但也接近于0，当信道随时间不同完全随机变化下，图像熵为7.0098。因此本文测量数据计算出的CSI图像熵应该出现在0.00006~7.0098之间。

本文在9种情况下，使用600组CSI计算图像熵，如表所示。从表中看出，无论哪种信道环境，室内房间的CSI随机性最低，室外的CSI随机性最高。无论哪种场景，终端固定的信道环境下的CSI随机性最低，终端移动的信道环境下的CSI随机性最高。所有情况中，在室内场景下的终端固定时CSI随机性最低，低至2.5391；在室外场景下终端移动时CSI随机性最高，高达4.0924

## 系统性能评估-TDD-随机性评估-密钥随机性

本文选择NIST随机性测试中的7种随机性测试方法测试密钥随机性，本文分别计算降采样率1,4,8时的测试结果，如表所示

表中数据为600组数据中通过NIST测试的比例，用横线标记出比例小于1%的数据

## 系统性能评估-TDD-随机性评估-密钥随机性

这是降采样率4的测试结果

## 系统性能评估-TDD-随机性评估-密钥随机性

这是降采样率8的测试结果

可以看出，随着降采样率提高，比率小于1%的数据减少，密钥随机性提高。在降采样率为１时，多组数组在NIST随机性测试中表现很差，在降采样率为8时，系统生成密钥数据在NIST随机测试中表现良好

## 系统性能评估-TDD-密钥生成速率

调整采样率可以影响密钥生成速率，降采样率过高，密钥生成速率降低，降采样率过低，密钥生成速率提高，但密钥一致率会降低。本文计算了室内终端固定情况下，不同降采样率的密钥生成速率，如图所示，观察可知，密钥生成速率随着降采样率升高而降低，在采样率为4时，密钥生成速率高达92.2231 bits/s，采样率为20时，密钥生成速率降低到15.9688 bits/s

## 系统性能评估-TDD-纠错码BER

发送端使用随机的消息比特作为输入，利用纠错码编码，再与密钥流异或，接收端再与密钥流异或，然后送入纠错码解码。本文计算9种情况下BCH码和Turbo码的纠错能力，每种情况使用600组数据计算纠错之前的平均密钥一致率以及纠错之后的平均误码率

左图为BCH的纠错效果, 其中参数N = 31, K = 11。右图为turbo的纠错效果，迭代次数为8, N = 2, K = 3

所有场景中，密钥一致率最高为室外终端固定的 95%，其也对应着最低的误比特率 1.43%；密钥一致率最低为室内终端移动场景 91.75%，其对应这最高的误比特率 5.29%。相对于 BCH 纠错码来说，Turbo 码的误比特率更小一些，因为有的时候会错误比特太多，超出BCH纠错能力

## 系统性能评估-FDD

和TDD相似，本文同样在FDD模式下的9种情况中，连续采集600组数据，并计算相应指标。FDD模式下的实验参数如表所示。导频信号中正弦波频率、M序列长度与TDD模式相同。USRP采样率设置为25MHz，FDD的上下行频率分别是2535MHz和2595MHz

Alice在三个场景、三种信道环境的600组CSI，如右图所示，x是测量次数，y是子载波数，z轴是幅度值，即从时间维度来观察CSI的变化

## 系统性能评估-FDD-CSI相关性

本文也计算了FDD模式下，Alice和Bob之间CSI相关系数、Alice和Eve之间CSI相关系数，9种情况下的结果如左图，蓝色表示Alice和Bob之间CSI相关系数，红色表示Alice和Eve之间的互相关系数。将数据取平均得到右图，相对于TDD模式，FDD模式合法通信双方之间的互相关系数较差，甚至在一些情况下，还要弱于Eve

## 系统性能评估-FDD-信息泄漏率

和TDD一样，本文在9种情况下按照之前计算公式，计算多组安全信息率并平均，9种情况下的平均安全信息率如下图所示

从图里面可以知道，不管是室内、走廊还是室外，终端移动时安全信息率最高，其中在室内终端移动时，信息安全比率最高，数据为67.74%，这也是所有情况中的最高值，在室外终端移动时，信息安全比率为41.49%。在所有情况中，室外终端固定时的信息安全比率最低，低至15.57%


## 系统性能评估-FDD-随机性评估-CSI

和TDD一样，使用频域图像熵计算CSI随机性，9种情况下结果如表所示，不管哪种场景，终端固定的信道环境下的CSI随机性最低，终端移动的信道环境的CSI随机性最高，这一点和TDD相同。但和TDD相反的是，不管哪种信道环境，室内场景的CSI随机性最高，室外场景的CSI随机性最低。

## 系统性能评估-FDD-随机性评估-密钥随机性

同TDD一样，对生成的密钥作NIST测试，分别计算降采样率1\4\8时的测试结果，这里只展示采样率8时的测试结果，可以看出即使采样率为8时，NIST测试结果也依旧不理想

同TDD模式比较可知，TDD模式下生成密钥的随机性更好，通过测试的比率更高，而FDD模式下更差

## 系统性能评估-FDD-密钥生成速率

FDD模式下，计算了室内终端固定时，密钥生成速率和采样率的关系，成反比。在采样率4时，密钥生成速率为28.6667 bits/s，采样率20时，密钥生成速率4.6667 bits/s

FDD模式下密钥生成速率低于TDD模式，这是因为FDD模型下信道互易性较差，所以导致密钥一致率降低，

## 系统性能评估-FDD-纠错码BER

FDD模式下也计算了BCH和Turbo两种纠错码下的纠错性能，如图所示，左图BCH，右图Turbo。总体看，在FDD模式下使用纠错码方式去调和，表现不如TDD，这也是由于互易性较差导致的结果

根据数据来看，在表现都不好的情况下，Turbo纠错性能仍稍好于BCH，这和TDD一致

## 研究结论

本文基于GNURadio和USRP设计了无线密钥生成系统，研究了在不同场景下无线密钥生成技术的安全性和可靠性。通过大量实验表明，在TDD模式下，走廊和室外场景的信道和密钥随机性较高，并且周围环境的扰动对随机性有重要贡献。

此外，当有近距离窃听者存在时，第三方窃听者无法获得相似的无线信道。通过分析TDD的安全泄漏率，我们发现，无论哪种环境下窃听者获得的秘密信息比率都很低，不高于32.95%，充分验证了无线密钥生成技术的安全性

此外，通过评估CSI和密钥的随机性，我们发现，通过合理设计系统参数，设置合适的降采样率，可以生成满足NIST随机性需求的密钥

通过分析图像熵，我们可以得出无论什么场景下，无线信道密钥技术都可以保证其CSI满足足够的随机性，因此该技术在实际环境中可以满足可靠性的要求

系统可以在满足安全性和可靠性的基础上，在降采样率为8时，达到密钥生成速率 42.2188 bits/s

最后，FDD模式下各项指标均差于TDD模式，这是因为FDD模型下，上下行信道的互易性较差，导致密钥一致率较低，进而降低密钥生成速率等指标

## todo 

图像熵的合理性在哪里

密钥的随机性其实不算太好

N = 2 K = 3 的意义

## todo - 要不要把频偏估计加上去